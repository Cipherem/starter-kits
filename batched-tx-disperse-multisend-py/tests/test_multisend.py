"""Test the transaction parsing for the Multisend contract"""

import pytest
import web3

import src.multisend as multisend

# FIXTURES ####################################################################

TRANSACTION_INPUTS = {
    'corrupted-data': '0xe46a03340000000000000000000000000eb60c48a1aea8a84d3333962d8fb6529f2a3ef8a000000000000000000000000dcba1d220959402eb1ad903cb6b50aefb30b03ae000000000000000000000000a88b2947650c1c45e6cf97a895e48e0c8ddbf3d7000000000000000000000000df2dcf3c6bb807116d2ad70d0641d1f504903964000000000000000000000000c864fca1e9b3f2bdd0c8206400f3f6530adcdca3000000000000000000000000195ad1dad0525f906d91319fbb22ab0288a6b879000000000000000000000000fd80e81df83f34312d966496ea943cf57070f0ea000000000000000000000000be231b29968b25bbacb146f9debb5e56b443ce7b00000000000000000000000096e0e0f11a6f1a2c268990067da6d4e0fa851846000000000000000000000000ec68a45f709735994e53',
    'multisend-eth': '0xab883d28000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000006800000000000000000000000000000000000000000000000000000000000000031000000000000000000000000790e323f2044ce4831dcd3e4a7b4e01369c23d5e000000000000000000000000da3863583c9fcd8a5d3506d91aaf33157124d1d10000000000000000000000007a669e418c52bf92b9d189065804cc778c034ddf000000000000000000000000fc249d7e3248d17a079071c1cc26ec1674e8c981000000000000000000000000dc3529ae55d013ecb89d1a17b03a0949348ffbce000000000000000000000000783de2b232b6211c641ea88510279215e737803a0000000000000000000000004cc22980b43c6711225c77e76bd21a1f99c9df7b000000000000000000000000d827eb2673d3dc1a7f886413f6f0950ec2fbbc9800000000000000000000000040415c1c0e7a8ff3e184b51a94a2fc5b92df943400000000000000000000000059fc71b07c4c533d83f29fb5e7c2d4ae6ea831ee00000000000000000000000026fde1f19c3e646b47d3fbffd3eb00e9053b8c0d0000000000000000000000002eefdaf85db08e9ca805ff9c2383ba2111bc1157000000000000000000000000610cc186770ee88675b1728c37689f344e4a4b090000000000000000000000009c87a1065994f156f0b7b87aaa8b3c5f7bd67e02000000000000000000000000b37955c7da362499448274c28aeb0eea6cf53d010000000000000000000000006a56f8613c494c95de6adccbf9747b37f67af0c200000000000000000000000062313a505a91cf71448c0a05a2837346f157eb8b0000000000000000000000000a20f76999c097cc0fdf557a48be91598b342b71000000000000000000000000db7f66f3d53a6a0ec43a49c7b6713e1bd3bd138300000000000000000000000024c3268f8e42c961074a88473ff07d87040f3fb1000000000000000000000000549418604d15df787eb24ca47f1f02fcf1600a52000000000000000000000000d75d6d2938c9bacff538ab658c797f38feafb27d000000000000000000000000971a1e211b90703375e20fe58b8d6ec24a462685000000000000000000000000f69c3f88e9bffaa1ae606fed45554207bf66d5e9000000000000000000000000efbe74a2d564b5da62407d452038db32c9fd6b270000000000000000000000008610df5a928e4bcec0eaf3df4aaa66ca2ceb06ae00000000000000000000000030e9217e1eb647445f30fe5c6051b361360571a90000000000000000000000007f8ec393b8f1b7de8d6e9b089d9819e5217046c3000000000000000000000000fad9ea29ae51b72a605c9952fe49048c7610957700000000000000000000000026c46e6f7b37e3eea85b6edf0e95583d0bb292ad000000000000000000000000c802883c7633386a592031dccd04b0d1994928be000000000000000000000000ba17c73b503947dd1e2e4ee653f02f7650ead3450000000000000000000000005bfeb4ca066c9458842ac89b6e5cd983bd1a1034000000000000000000000000bf2f83ccba9f767485485ea0131f1e6d104ac1ab00000000000000000000000056fcca6db2780b1acca2cdd875882e9d16e8c401000000000000000000000000dace572b77a01f056cad9190d03e28e94d991118000000000000000000000000dff3789d4c45eb099f3d9ea4e0f1ce59f8e58cc2000000000000000000000000989ee99e6dffcc9f993ec763d789c38c2d82feb4000000000000000000000000213b027d6405f82310a4dc7f1c692f1ac7d865de000000000000000000000000fa2930a9d96e91b0a7e78d9febb7a8c744afd0da000000000000000000000000d577df616cbfda9c7d322e8cb5938cd9a47b837e0000000000000000000000003d344666bf19d31fe215bdfe1698bc2b0e6caacc0000000000000000000000004322d6b24bda8af69dd1014c4f29138f6d794ada000000000000000000000000a6f44026b1ec71d855a9acf6e7e6431a02eac39400000000000000000000000022d8d269a083ead12e8d7f8fb9add8a38b5f4134000000000000000000000000622b3565cad3b91c35a7dde9ace8255fe2c70315000000000000000000000000b9492f6158ca8c1446d1dd3186c453d2fb115f48000000000000000000000000d483ced7803b6bfa66acfe72d86f6f67ad87a059000000000000000000000000bae33e3edaaf0e62dc04cb3b9f10cc0050a433910000000000000000000000000000000000000000000000000000000000000031000000000000000000000000000000000000000000000000001dd7c1681d00000000000000000000000000000000000000000000000000000059874438570000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000002cc3a21c2b800000000000000000000000000000000000000000000000000000775f05a0740000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000004a9b6384488000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000003baf82d03a0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000004a9b6384488000000000000000000000000000000000000000000000000000003baf82d03a0000000000000000000000000000000000000000000000000000004a9b6384488000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000009536c708910000000000000000000000000000000000000000000000000000003baf82d03a0000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000003baf82d03a0000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000000eebe0b40e800000000000000000000000000000000000000000000000000000687324ec658000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000000eebe0b40e8000000000000000000000000000000000000000000000000000001dd7c1681d0000000000000000000000000000000000000000000000000000002cc3a21c2b8000000000000000000000000000000000000000000000000000000eebe0b40e8000',
    'multisend-token': '0x0b66f3f5000000000000000000000000b23a19d28a7e9bdec030782346b0d9ace11530f5000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000005e0000000000000000000000000000000000000000000000000000000000000002b000000000000000000000000d5481575130a7decf4503c81a50152b3753031f90000000000000000000000007b753919b953b1021a33f55671716dc13c1eae080000000000000000000000009d7750ff4cfda1988ab08a7315d30064ab2058060000000000000000000000009ea38c605c07f926df8bde0b3701b5d60c2e6ec6000000000000000000000000b2ea3889506327db2defb9554752d211f8e2a366000000000000000000000000d72cb55fd6e7d94808b27b15f6132cdfcf5a0461000000000000000000000000f7b18e107eb36797f4ce36de756630b9c30969ad000000000000000000000000ddf2f1896224fd357161216dac3331e203cc354100000000000000000000000054307a0744c24bfd5899d4c6b19934736b39349c000000000000000000000000698e9a51378ed9b292e1ea27cd2ba419aee0e4a400000000000000000000000079a3d154b017193464774683f4698d6e0f98cad900000000000000000000000051a5db7df4bc1df6669cc3f0dc9184da9a06bd19000000000000000000000000a02b254808462f5b34b6f93526449a1d972cbe46000000000000000000000000c37e67148ed61006074554ed00691f5183206020000000000000000000000000b774c54b016b79bbec24b2e8af0535e420476a08000000000000000000000000022e73a40f6a719bdde859620c1191fa3554be1d000000000000000000000000000ab07b26c48ef3caf9ec23520d86794c9fd74a000000000000000000000000324a77ffee86a7ec082f8395f060bc4e94e601980000000000000000000000003360a4e0eb33161da911b85f7c343e02ea41bbbd0000000000000000000000003a2a72ff37afe42b2c2747366be5ecdacb211d8a00000000000000000000000064b81b0c40dde40d0e0e1a7e87300a7cb02d04f50000000000000000000000006cd68e8f04490cd1a5a21cc97cc8bc15b47dc9eb0000000000000000000000008023dccc72d5ffd7dc224518ddca72b7be1cb8df0000000000000000000000009c6f3006085575d711a2b37f639047e9232c1759000000000000000000000000b778194f59871bae39ffee15ddcb05972472366b000000000000000000000000bec2635b44d26acf54dda59644ddb71fb0e0268d0000000000000000000000000c3ad884578178f6782d637cb0531a75aa1760e000000000000000000000000011b4e83bc3e9605f03e2a4c34bd09567be5aebbe000000000000000000000000169bc8711d371711932ec3845fbaa6928057a1890000000000000000000000002ac6e5b6a4e393202253eac03a428d2f52b8606900000000000000000000000033fc2be5563e3c02a3e127f01bbd71db472aa6130000000000000000000000003585ca22df80d70f6d1cc0867d8387c3601813490000000000000000000000004834614c3993e059a5f70a2d48a4ea90d30e7c1300000000000000000000000075d514b6040727c19ae06ae8f1a1c7912c4c91c00000000000000000000000007e28bbdcc4d3c3c8df646c37ac0ee66ad1c9c04d0000000000000000000000009156659d080ed0d8b88b83fb3072cd8a78c17e14000000000000000000000000a3560e3ed5ed0f0901df9ca02b8518bc1f00470a000000000000000000000000ad83954e1584e7df91ef1e1a5f5661684e2dc751000000000000000000000000b25e1b7d4a5b0486285a60501b05a45a6a6cb6ba000000000000000000000000b3da159cfeb3b5319f4d5a1fc6ad7193ffbde459000000000000000000000000b404f05e71fc9d065a3bc26815a0d56880bc8315000000000000000000000000cbefc51ae3dea6a40c0182cd05c985f0f3b66633000000000000000000000000db5c24bb90030ed61c91896c5111a954d9375b4e000000000000000000000000000000000000000000000000000000000000002b000000000000000000000000000000000000000000000008670e9ec6598c00000000000000000000000000000000000000000000000000068155a43676e000000000000000000000000000000000000000000000000000068155a43676e000000000000000000000000000000000000000000000000000068155a43676e000000000000000000000000000000000000000000000000000068155a43676e000000000000000000000000000000000000000000000000000068155a43676e00000000000000000000000000000000000000000000000000005f68e8131ecf800000000000000000000000000000000000000000000000000049b9ca9a694340000000000000000000000000000000000000000000000000004563918244f400000000000000000000000000000000000000000000000000004563918244f400000000000000000000000000000000000000000000000000004563918244f40000000000000000000000000000000000000000000000000000410d586a20a4c000000000000000000000000000000000000000000000000000410d586a20a4c000000000000000000000000000000000000000000000000000410d586a20a4c0000000000000000000000000000000000000000000000000003cb71f51fc558000000000000000000000000000000000000000000000000000270801d946c9400000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000022b1c8c1227a00000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000000000000000000000000000000000000000000000000001e5b8fa8fe2ac0000',
}

@pytest.fixture
def w3():
    return web3.Web3(web3.EthereumTesterProvider())

@pytest.fixture
def base_parser(w3):
    return multisend.parse_transaction_input_factory(w3)

# DATA CORRUPTION #############################################################

def test_does_not_throw_on_corrupted_data(base_parser):
    assert len(base_parser(TRANSACTION_INPUTS['corrupted-data'])) == 0

# ETH #########################################################################

def test_ignores_batched_eth_transfers(base_parser):
    assert len(base_parser(TRANSACTION_INPUTS['multisend-eth'])) == 0

# ERC20 #######################################################################

def test_parses_recipients_and_values_from_batch_transaction(base_parser):
    assert len(base_parser(TRANSACTION_INPUTS['multisend-token'])) > 1

# FILTER ERC20 ################################################################
